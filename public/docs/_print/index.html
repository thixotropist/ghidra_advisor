<!doctype html>
<html itemscope itemtype="http://schema.org/WebPage" lang="en" class="no-js">
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link rel="canonical" type="text/html" href="ghidra_advisor/docs/">
<link rel="alternate" type="application/rss&#43;xml" href="ghidra_advisor/docs/index.xml">
<meta name="robots" content="noindex, nofollow">


<link rel="shortcut icon" href="/ghidra_advisor/favicons/favicon.ico" >
<link rel="apple-touch-icon" href="/ghidra_advisor/favicons/apple-touch-icon-180x180.png" sizes="180x180">
<link rel="icon" type="image/png" href="/ghidra_advisor/favicons/favicon-16x16.png" sizes="16x16">
<link rel="icon" type="image/png" href="/ghidra_advisor/favicons/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="/ghidra_advisor/favicons/android-36x36.png" sizes="36x36">
<link rel="icon" type="image/png" href="/ghidra_advisor/favicons/android-48x48.png" sizes="48x48">
<link rel="icon" type="image/png" href="/ghidra_advisor/favicons/android-72x72.png" sizes="72x72">
<link rel="icon" type="image/png" href="/ghidra_advisor/favicons/android-96x96.png" sizes="96x96">
<link rel="icon" type="image/png" href="/ghidra_advisor/favicons/android-144x144.png" sizes="144x144">
<link rel="icon" type="image/png" href="/ghidra_advisor/favicons/android-192x192.png" sizes="192x192">

<title>Ghidra Advisor Reference | Ghidra Advisor for RISCV-64 Vector Extensions</title>
<meta name="description" content="Powerful, extensible, and feature-packed frontend toolkit. Build and customize with Sass, utilize prebuilt grid system and components, and bring projects to life with powerful JavaScript plugins.">
<meta property="og:url" content="ghidra_advisor/docs/">
  <meta property="og:site_name" content="Ghidra Advisor for RISCV-64 Vector Extensions">
  <meta property="og:title" content="Ghidra Advisor Reference">
  <meta property="og:description" content="Powerful, extensible, and feature-packed frontend toolkit. Build and customize with Sass, utilize prebuilt grid system and components, and bring projects to life with powerful JavaScript plugins.">
  <meta property="og:locale" content="en_us">
  <meta property="og:type" content="website">

  <meta itemprop="name" content="Ghidra Advisor Reference">
  <meta itemprop="description" content="Powerful, extensible, and feature-packed frontend toolkit. Build and customize with Sass, utilize prebuilt grid system and components, and bring projects to life with powerful JavaScript plugins.">
  <meta itemprop="dateModified" content="2024-11-02T15:00:04-04:00">
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Ghidra Advisor Reference">
  <meta name="twitter:description" content="Powerful, extensible, and feature-packed frontend toolkit. Build and customize with Sass, utilize prebuilt grid system and components, and bring projects to life with powerful JavaScript plugins.">




<link rel="preload" href="ghidra_advisor/scss/main.min.566d7ac1e84fdb8192a82cf733a3d350d86778608b7404836e1cd5c1232ef742.css" as="style">
<link href="ghidra_advisor/scss/main.min.566d7ac1e84fdb8192a82cf733a3d350d86778608b7404836e1cd5c1232ef742.css" rel="stylesheet" integrity="">

<script
  src="https://code.jquery.com/jquery-3.7.1.min.js"
  integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g=="
  crossorigin="anonymous"></script>

  </head>
  <body class="td-section">
    <header>
      <nav class="td-navbar js-navbar-scroll" data-bs-theme="dark">
<div class="container-fluid flex-column flex-md-row">
  <a class="navbar-brand" href="ghidra_advisor/"><span class="navbar-brand__logo navbar-logo"><svg id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 500 500" style="enable-background:new 0 0 500 500"><g><path style="fill:#fff" d="M116.8525 421.9722c-5.7041.0-10.3442-4.3127-10.3442-9.6129V88.183c0-5.3002 4.6401-9.6117 10.3442-9.6117H320.858c3.0347.0 9.3959.5498 11.7506 2.6302l.3545.3442 58.905 63.2912c2.3101 2.491 2.9202 8.4928 2.9202 11.3184v256.2039c0 5.3002-4.6407 9.6129-10.3436 9.6129H116.8525z"/><g><g><g><path style="fill:#767676" d="M384.4445 423.2066H116.852c-6.3839.0-11.5786-4.8658-11.5786-10.8474V88.1831c0-5.9804 5.1947-10.8461 11.5786-10.8461h204.0062c.377.0 9.2786.0329 12.568 2.9389l.3947.3833 58.9508 63.337c3.2135 3.4652 3.2514 11.7924 3.2514 12.1593v256.2036C396.0231 418.3408 390.8284 423.2066 384.4445 423.2066zM116.5079 411.9189c.0848.0278.1999.0531.3441.0531h267.5925c.1442.0.2581-.0253.3441-.0531V156.1556c-.0076-.9033-.3593-3.7347-.7034-5.0037l-57.6527-61.9416c-1.4651-.3176-4.4533-.6389-5.5742-.6389H116.852c-.143.0-.2594.024-.3441.0531V411.9189zm267.4533-261.149zM327.0321 89.371v.0013V89.371z"/></g></g></g><g><g><path style="fill:#5b7fc0" d="M189.0874 210.1754l.0012-.0012c7.7751.0012 15.0295 4.1862 18.932 10.9234 1.9177 3.3159 2.9305 7.1011 2.9293 10.9378.0 5.8394-2.2733 11.3304-6.4032 15.4604-4.1288 4.1288-9.6186 6.4032-15.458 6.4032s-11.328-2.2733-15.458-6.4032-6.4032-9.6186-6.4056-15.4628c.0012-6.025 2.454-11.4897 6.4116-15.4473C177.5953 212.627 183.0601 210.1742 189.0874 210.1754zm7.993 21.8576c.0012-1.4042-.3687-2.7868-1.063-3.9887-1.4293-2.4684-4.0833-3.9995-6.9299-4.0019-4.4077.0024-7.993 3.5877-7.993 7.993.0 2.1356.832 4.1431 2.3427 5.6539 1.5083 1.5083 3.5159 2.3403 5.6503 2.3415 2.1356.0 4.1443-.8308 5.6539-2.3403S197.0816 234.1722 197.0804 232.033z"/><path style="opacity:.3;fill:#fff" d="M189.0898 210.176c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3136 2.9377 7.0988 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8066-21.8612-21.8613.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 212.6276 183.0612 210.176 189.0898 210.176zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 236.239 197.0839 234.2399 197.0839 232.0372z"/><g><defs><path id="SVGID_1_" d="M194.7376 237.6875c-1.4461 1.4461-3.4452 2.3439-5.6479 2.3439-4.4077-.0024-7.9918-3.5865-7.9942-7.9942.0024-4.4125 3.5937-7.999 7.9942-7.9942 2.8443.0 5.497 1.5323 6.924 3.9983.6991 1.2067 1.0702 2.5881 1.0702 3.9959C197.0839 234.2399 196.1861 236.239 194.7376 237.6875z"/></defs><clipPath id="SVGID_2_"><use xlink:href="#SVGID_1_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_2_);fill:#fff" d="M190.0704 225.0237c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9546.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.663-2.8588-6.116.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C193.7885 225.7247 191.9774 225.0237 190.0704 225.0237z"/><path style="opacity:.13;clip-path:url(#SVGID_2_);fill:#020202" d="M190.0704 225.0237c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9546.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.663-2.8588-6.116.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C193.7885 225.7247 191.9774 225.0237 190.0704 225.0237z"/></g><g><defs><path id="SVGID_3_" d="M189.0898 210.176c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3136 2.9377 7.0988 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8066-21.8612-21.8613.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 212.6276 183.0612 210.176 189.0898 210.176zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 236.239 197.0839 234.2399 197.0839 232.0372z"/></defs><clipPath id="SVGID_4_"><use xlink:href="#SVGID_3_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_4_);fill:#5b7fc0" d="M172.6595 215.6045c-3.96 3.96-6.4116 9.4235-6.4116 15.452-.0024 12.0547 9.8066 21.8636 21.8613 21.8612 12.0547.0024 21.8636-9.797 21.8613-21.8612.0024-3.8475-1.0151-7.6326-2.9353-10.9462-3.8977-6.7324-11.1497-10.9151-18.926-10.9151C182.0806 209.1953 176.6171 211.647 172.6595 215.6045z"/></g></g><rect x="198.8952" y="225.1043" style="fill:#5b7fc0" width="122.6266" height="13.8671"/></g><g><path style="fill:#d95140" d="M189.0874 155.7611l.0012-.0012c7.7751.0012 15.0295 4.1862 18.932 10.9234 1.9177 3.3159 2.9305 7.1011 2.9293 10.9378.0 5.8394-2.2733 11.3304-6.4032 15.4604-4.1288 4.1288-9.6186 6.4032-15.458 6.4032s-11.328-2.2733-15.458-6.4032-6.4032-9.6186-6.4056-15.4628c.0012-6.0249 2.454-11.4897 6.4116-15.4473C177.5953 158.2128 183.0601 155.7599 189.0874 155.7611zm7.993 21.8577c.0012-1.4042-.3687-2.7868-1.063-3.9887-1.4293-2.4684-4.0833-3.9995-6.9299-4.0019-4.4077.0024-7.993 3.5877-7.993 7.993.0 2.1356.832 4.1431 2.3427 5.6539 1.5083 1.5083 3.5159 2.3403 5.6503 2.3415 2.1356.0 4.1443-.8308 5.6539-2.3403C196.2508 181.7667 197.0816 179.758 197.0804 177.6188z"/><path style="opacity:.3;fill:#fff" d="M189.0898 155.7617c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3135 2.9377 7.0987 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8066-21.8612-21.8613.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 158.2134 183.0612 155.7617 189.0898 155.7617zm7.9941 21.8613c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 181.8248 197.0839 179.8256 197.0839 177.623z"/><g><defs><path id="SVGID_5_" d="M194.7376 183.2733c-1.4461 1.4461-3.4452 2.3439-5.6479 2.3439-4.4077-.0024-7.9918-3.5865-7.9942-7.9942.0024-4.4125 3.5937-7.9989 7.9942-7.9942 2.8443.0 5.497 1.5323 6.924 3.9983.6991 1.2067 1.0702 2.5881 1.0702 3.9959C197.0839 179.8256 196.1861 181.8248 194.7376 183.2733z"/></defs><clipPath id="SVGID_6_"><use xlink:href="#SVGID_5_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_6_);fill:#fff" d="M190.0704 170.6095c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9546.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.663-2.8588-6.116.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C193.7885 171.3104 191.9774 170.6095 190.0704 170.6095z"/><path style="opacity:.13;clip-path:url(#SVGID_6_);fill:#020202" d="M190.0704 170.6095c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9546.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.663-2.8588-6.116.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C193.7885 171.3104 191.9774 170.6095 190.0704 170.6095z"/></g><g><defs><path id="SVGID_7_" d="M189.0898 155.7617c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3135 2.9377 7.0987 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8066-21.8612-21.8613.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 158.2134 183.0612 155.7617 189.0898 155.7617zm7.9941 21.8613c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 181.8248 197.0839 179.8256 197.0839 177.623z"/></defs><clipPath id="SVGID_8_"><use xlink:href="#SVGID_7_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_8_);fill:#d95140" d="M172.6595 161.1903c-3.96 3.96-6.4116 9.4235-6.4116 15.452-.0024 12.0547 9.8066 21.8636 21.8613 21.8613 12.0547.0024 21.8636-9.797 21.8613-21.8613.0024-3.8474-1.0151-7.6326-2.9353-10.9462-3.8977-6.7324-11.1497-10.9151-18.926-10.9151C182.0806 154.7811 176.6171 157.2327 172.6595 161.1903z"/></g><rect x="198.8952" y="170.69" style="fill:#d95140" width="122.6266" height="13.8671"/></g><g><g><path style="fill:#56a55c" d="M189.5379 264.6147l.0012-.0012c7.7751.0012 15.0294 4.1862 18.932 10.9235 1.9177 3.3159 2.9305 7.1011 2.9293 10.9378.0 5.8394-2.2733 11.3304-6.4032 15.4604-4.1288 4.1288-9.6186 6.4032-15.458 6.4032-5.8394.0-11.3281-2.2733-15.458-6.4032-4.13-4.13-6.4032-9.6186-6.4056-15.4628.0012-6.0249 2.454-11.4897 6.4116-15.4472C178.0458 267.0663 183.5105 264.6135 189.5379 264.6147zm7.993 21.8576c.0012-1.4042-.3687-2.7868-1.063-3.9887-1.4293-2.4684-4.0833-3.9995-6.9299-4.0019-4.4077.0024-7.993 3.5877-7.993 7.993.0 2.1356.832 4.1431 2.3427 5.6538 1.5083 1.5083 3.5159 2.3403 5.6503 2.3415 2.1356.0 4.1443-.8308 5.6539-2.3403C196.7013 290.6202 197.5321 288.6115 197.5309 286.4723z"/><path style="opacity:.3;fill:#fff" d="M189.5403 264.6153c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3135 2.9377 7.0987 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8065-21.8612-21.8613.0-6.0285 2.4516-11.492 6.4116-15.452C178.0482 267.0669 183.5117 264.6153 189.5403 264.6153zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9941.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.6366 290.6783 197.5344 288.6792 197.5344 286.4765z"/><g><defs><path id="SVGID_9_" d="M195.1881 292.1268c-1.4461 1.4461-3.4452 2.3439-5.6479 2.3439-4.4077-.0024-7.9918-3.5865-7.9942-7.9942.0024-4.4125 3.5937-7.9989 7.9942-7.9941 2.8443.0 5.497 1.5323 6.924 3.9983.6991 1.2067 1.0702 2.5881 1.0702 3.9959C197.5344 288.6792 196.6366 290.6783 195.1881 292.1268z"/></defs><clipPath id="SVGID_10_"><use xlink:href="#SVGID_9_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_10_);fill:#fff" d="M190.5209 279.463c-4.4005-.0048-7.9918 3.5817-7.9942 7.9941.0011 1.9547.7088 3.7452 1.8782 5.1354-1.7446-1.4674-2.8575-3.6631-2.8588-6.1161.0024-4.4125 3.5936-7.999 7.9942-7.9941 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C194.239 280.164 192.4279 279.463 190.5209 279.463z"/><path style="opacity:.13;clip-path:url(#SVGID_10_);fill:#020202" d="M190.5209 279.463c-4.4005-.0048-7.9918 3.5817-7.9942 7.9941.0011 1.9547.7088 3.7452 1.8782 5.1354-1.7446-1.4674-2.8575-3.6631-2.8588-6.1161.0024-4.4125 3.5936-7.999 7.9942-7.9941 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C194.239 280.164 192.4279 279.463 190.5209 279.463z"/></g><g><defs><path id="SVGID_11_" d="M189.5403 264.6153c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3135 2.9377 7.0987 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8065-21.8612-21.8613.0-6.0285 2.4516-11.492 6.4116-15.452C178.0482 267.0669 183.5117 264.6153 189.5403 264.6153zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9941.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.6366 290.6783 197.5344 288.6792 197.5344 286.4765z"/></defs><clipPath id="SVGID_12_"><use xlink:href="#SVGID_11_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_12_);fill:#56a55c" d="M173.11 270.0439c-3.96 3.96-6.4116 9.4235-6.4116 15.452-.0024 12.0547 9.8066 21.8636 21.8613 21.8613 12.0547.0024 21.8636-9.797 21.8613-21.8613.0024-3.8474-1.0151-7.6326-2.9353-10.9462-3.8977-6.7325-11.1497-10.9151-18.926-10.9151C182.5311 263.6346 177.0676 266.0863 173.11 270.0439z"/></g></g><rect x="199.3456" y="279.5436" style="fill:#56a55c" width="122.6266" height="13.8671"/></g><g><g><path style="fill:#f1bc42" d="M189.0874 318.7208l.0012-.0012c7.7751.0012 15.0295 4.1862 18.932 10.9234 1.9177 3.3159 2.9305 7.1011 2.9293 10.9378.0 5.8394-2.2733 11.3305-6.4032 15.4604-4.1288 4.1288-9.6186 6.4032-15.458 6.4032s-11.328-2.2733-15.458-6.4032-6.4032-9.6186-6.4056-15.4628c.0012-6.025 2.454-11.4897 6.4116-15.4472C177.5953 321.1724 183.0601 318.7196 189.0874 318.7208zm7.993 21.8576c.0012-1.4042-.3687-2.7868-1.063-3.9887-1.4293-2.4684-4.0833-3.9995-6.9299-4.0019-4.4077.0024-7.993 3.5877-7.993 7.993.0 2.1356.832 4.1431 2.3427 5.6539 1.5083 1.5083 3.5159 2.3403 5.6503 2.3415 2.1356.0 4.1443-.8308 5.6539-2.3403S197.0816 342.7176 197.0804 340.5784z"/><path style="opacity:.3;fill:#fff" d="M189.0898 318.7214c7.7763.0 15.0283 4.1826 18.926 10.915 1.9201 3.3136 2.9377 7.0988 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8612-12.0547.0024-21.8636-9.8065-21.8612-21.8612.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 321.173 183.0612 318.7214 189.0898 318.7214zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 344.7844 197.0839 342.7853 197.0839 340.5826z"/><g><defs><path id="SVGID_13_" d="M194.7376 346.2329c-1.4461 1.4461-3.4452 2.3439-5.6479 2.3439-4.4077-.0024-7.9918-3.5865-7.9942-7.9942.0024-4.4125 3.5937-7.999 7.9942-7.9942 2.8443.0 5.497 1.5323 6.924 3.9983.6991 1.2067 1.0702 2.5881 1.0702 3.9959C197.0839 342.7853 196.1861 344.7844 194.7376 346.2329z"/></defs><clipPath id="SVGID_14_"><use xlink:href="#SVGID_13_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_14_);fill:#fff" d="M190.0704 333.5691c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9547.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.6631-2.8588-6.1161.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0834 6.1218 2.8788C193.7885 334.2701 191.9774 333.5691 190.0704 333.5691z"/><path style="opacity:.13;clip-path:url(#SVGID_14_);fill:#020202" d="M190.0704 333.5691c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9547.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.6631-2.8588-6.1161.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0834 6.1218 2.8788C193.7885 334.2701 191.9774 333.5691 190.0704 333.5691z"/></g><g><defs><path id="SVGID_15_" d="M189.0898 318.7214c7.7763.0 15.0283 4.1826 18.926 10.915 1.9201 3.3136 2.9377 7.0988 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8612-12.0547.0024-21.8636-9.8065-21.8612-21.8612.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 321.173 183.0612 318.7214 189.0898 318.7214zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 344.7844 197.0839 342.7853 197.0839 340.5826z"/></defs><clipPath id="SVGID_16_"><use xlink:href="#SVGID_15_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_16_);fill:#f1bc42" d="M172.6595 324.15c-3.96 3.96-6.4116 9.4235-6.4116 15.452-.0024 12.0547 9.8066 21.8636 21.8613 21.8612 12.0547.0024 21.8636-9.797 21.8613-21.8612.0024-3.8474-1.0151-7.6327-2.9353-10.9462-3.8977-6.7324-11.1497-10.9151-18.926-10.9151C182.0806 317.7407 176.6171 320.1924 172.6595 324.15z"/></g></g><rect x="198.8952" y="333.6497" style="fill:#f1bc42" width="122.6266" height="13.8671"/></g></g></svg></span><span class="navbar-brand__name">Ghidra Advisor for RISCV-64 Vector Extensions</span></a>
  <div class="td-navbar-nav-scroll ms-md-auto" id="main_navbar">
    <ul class="navbar-nav">
      <li class="nav-item">
        <a class="nav-link active" href="ghidra_advisor/docs/"><span>Documents</span></a>
      </li>
      </ul>
  </div>
  <div class="d-none d-lg-block">
    
  </div>
</div>
</nav>
    </header>
    <div class="container-fluid td-outer">
      <div class="td-main">
        <div class="row flex-xl-nowrap">
          <main class="col-12 col-md-9 col-xl-8 ps-md-5" role="main">
            




<div class="td-content">
<div class="pageinfo pageinfo-primary d-print-none">
<p>
This is the multi-page printable view of this section.
<a href="#" onclick="print();return false;">Click here to print</a>.
</p><p>
<a href="ghidra_advisor/docs/">Return to the regular view of this page</a>.
</p>
</div>



<h1 class="title">Ghidra Advisor Reference</h1>





    <ul>
    
  
  
  
  

  
    
    
	
<li>1: <a href="#pg-fb0f854c53f1ba28ad4c2ccf8d24df34">Ghidra Advisor Examples</a></li>


    
    <ul>
        
  
  
  
  

  
    
    
	
<li>1.1: <a href="#pg-b3ec820b617511fd4bfcdb39b9b1e8f6">Whisper.cpp Example</a></li>


    
  
    
    
	
<li>1.2: <a href="#pg-b7fe35a883aba80b94da14f1a7088bd6">DPDK Network Example</a></li>


    
  

    </ul>
    
  
    
    
	
<li>2: <a href="#pg-4ec550678510a1633618c95f28de2784">Ghidra Advisor Reference</a></li>


    
    <ul>
        
  
  
  
  

  
    
    
	
<li>2.1: <a href="#pg-868196f5affa8721be3812a5a8efb1d8">Advisor Dependencies</a></li>


    
  
    
    
	
<li>2.2: <a href="#pg-f21f4498c9757bdf77b86a4592fd69d4">Populating the Database</a></li>


    
  
    
    
	
<li>2.3: <a href="#pg-1dc8dc49d608914ca839f8eefdd93a8e">Feature Analysis</a></li>


    
  
    
    
	
<li>2.4: <a href="#pg-7708ebcad404a8a36f7be4d1b0591b8c">Frequently Asked Questions</a></li>


    
  

    </ul>
    
  

    </ul>


<div class="content">
      
</div>
</div>


  
  
  
  

  
  

  
    
    
	
    

<div class="td-content" style="">
    
	<h1 id="pg-fb0f854c53f1ba28ad4c2ccf8d24df34">1 - Ghidra Advisor Examples</h1>
    
	
</div>



    
      
  
  
  
  

  
  

  
    
    
	
    

<div class="td-content" style="">
    
	<h1 id="pg-b3ec820b617511fd4bfcdb39b9b1e8f6">1.1 - Whisper.cpp Example</h1>
    
	<p>Let&rsquo;s inspect whisper.cpp binaries as compiled for a RISCV-64 processor with vector extensions.
We&rsquo;ll start with this snippet from the function <code>whisper_full_with_state</code>.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>000cc166 57 77 80 0d     vsetvli                        a4,zero,e64,m1,ta,ma
</span></span><span style="display:flex;"><span>000cc16a d7 a1 08 52     vid.v                          v3
</span></span><span style="display:flex;"><span>000cc16e d7 30 00 5e     vmv.v.i                        v1,0x0
</span></span><span style="display:flex;"><span>000cc172 93 06 80 03     li                             a3,0x38
</span></span><span style="display:flex;"><span>000cc176 d7 e1 36 96     vmul.vx                        v3,v3,a3
</span></span><span style="display:flex;"><span>000cc17a d6 86           c.mv                           a3,s5
</span></span><span style="display:flex;"><span>000cc17c ce 97           c.add                          a5,s3
</span></span><span style="display:flex;"><span>000cc17e 03 b6 07 18     ld                             a2,0x180(a5)
</span></span><span style="display:flex;"><span>000cc182 31 06           c.addi                         a2,0xc
</span></span><span style="display:flex;"><span>LAB_000cc184                                    XREF[1]:     000cc1a0(j)
</span></span><span style="display:flex;"><span>000cc184 d7 f7 76 09     vsetvli                        a5,a3,e32,mf2,tu,ma
</span></span><span style="display:flex;"><span>000cc188 07 71 36 06     vluxei64.v                     v2,(a2),v3
</span></span><span style="display:flex;"><span>000cc18c 57 32 10 9e     vmv1r.v                        v4,v1
</span></span><span style="display:flex;"><span>000cc190 13 97 37 00     slli                           a4,a5,0x3
</span></span><span style="display:flex;"><span>000cc194 1d 8f           c.sub                          a4,a5
</span></span><span style="display:flex;"><span>000cc196 0e 07           c.slli                         a4,0x3
</span></span><span style="display:flex;"><span>000cc198 9d 8e           c.sub                          a3,a5
</span></span><span style="display:flex;"><span>000cc19a d7 10 41 d2     vfwadd.wv                      v1,v4,v2
</span></span><span style="display:flex;"><span>000cc19e 3a 96           c.add                          a2,a4
</span></span><span style="display:flex;"><span>000cc1a0 f5 f2           c.bnez                         a3,LAB_000cc184
</span></span><span style="display:flex;"><span>000cc1a2 d3 07 00 f2     fmv.d.x                        fa5,zero
</span></span><span style="display:flex;"><span>000cc1a6 57 77 80 0d     vsetvli                        a4,zero,e64,m1,ta,ma
</span></span><span style="display:flex;"><span>000cc1aa 57 d1 07 42     vfmv.s.f                       v2,fa5
</span></span><span style="display:flex;"><span>000cc1ae d7 10 11 06     vfredusum.vs                   v1,v1,v2
</span></span><span style="display:flex;"><span>000cc1b2 d7 14 10 42     vfmv.f.s                       fs1,v1
</span></span></code></pre></div><h2 id="advisor-output">Advisor Output</h2>
<p>Signatures:</p>
<ul>
<li>Element width is = 64 bits</li>
<li>Vector element index: vid.v
<ul>
<li>often used in generating a vector of offsets for indexing</li>
</ul>
</li>
<li>Element width is = 32 bits
<ul>
<li>Vector multiplier is fractional, MUL = f2</li>
</ul>
</li>
<li>Vector unordered indexed load: vluxei64.v</li>
<li>Vector register move/copy: vmv1r.v</li>
<li>Element width is = 64 bits</li>
<li>FP register to vector register element 0</li>
<li>Vector floating point reduction: vfredusum.vs</li>
<li>Vector register element 0 to FP register</li>
<li>Significant opcodes, in the order they appear:
<ul>
<li>vsetvli,vid.v,vmv.v.i,vmul.vx,vsetvli,vluxei64.v,vmv1r.v,vfwadd.wv,c.bnez,vsetvli,vfmv.s.f,vfredusum.vs,vfmv.f.s</li>
</ul>
</li>
<li>Significant opcodes, in alphanumeric order:
<ul>
<li>c.bnez,vfmv.f.s,vfmv.s.f,vfredusum.vs,vfwadd.wv,vid.v,vluxei64.v,vmul.vx,vmv.v.i,vmv1r.v,vsetvli,vsetvli,vsetvli</li>
</ul>
</li>
<li>At least one loop exists</li>
</ul>
<h3 id="similarity-analysis">Similarity Analysis</h3>
<p>Compare the clipped example to the database of vectorized examples.</p>
<p>The best match is id=588 [0.687]= bnez,vfadd.vv,vle8.v,vlseg2e64.v,vmsne.vi,vmv.v.i,vmv1r.v,vse64.v,vsetvli,vsetvli,vsetvli</p>
<p>The clip is similar to the reference example <code>data/gcc_riscv_testsuite/rvv/autovec/struct/mask_struct_load-1_rv64gcv:test_f64_f64_i8_2</code></p>
<h4 id="reference-c-source">Reference C Source</h4>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">void</span> <span style="color:#000">test_f64_f64_i8_2</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">double</span> <span style="color:#ce5c00;font-weight:bold">*</span><span style="color:#000">__restrict</span> <span style="color:#000">dest</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#204a87;font-weight:bold">double</span> <span style="color:#ce5c00;font-weight:bold">*</span><span style="color:#000">__restrict</span> <span style="color:#000">src</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#204a87;font-weight:bold">int8_t</span> <span style="color:#ce5c00;font-weight:bold">*</span><span style="color:#000">__restrict</span> <span style="color:#000">cond</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#204a87;font-weight:bold">intptr_t</span> <span style="color:#000">n</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>  <span style="color:#204a87;font-weight:bold">for</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">intptr_t</span> <span style="color:#000">i</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#000">i</span> <span style="color:#ce5c00;font-weight:bold">&lt;</span> <span style="color:#000">n</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#ce5c00;font-weight:bold">++</span><span style="color:#000">i</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#000">cond</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">i</span><span style="color:#000;font-weight:bold">])</span>
</span></span><span style="display:flex;"><span>      <span style="color:#000">dest</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">i</span><span style="color:#000;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">src</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">i</span> <span style="color:#ce5c00;font-weight:bold">*</span> <span style="color:#0000cf;font-weight:bold">2</span><span style="color:#000;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#000">src</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">i</span> <span style="color:#ce5c00;font-weight:bold">*</span> <span style="color:#0000cf;font-weight:bold">2</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">];</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div><h4 id="reference-compiled-assembly-code">Reference Compiled Assembly Code</h4>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>2932	blez	a3,2970 &lt;test_f64_f64_i8_2+0x3e&gt;
</span></span><span style="display:flex;"><span>2936	vsetvli	a5,zero,e64,m1,ta,ma
</span></span><span style="display:flex;"><span>293a	vmv.v.i	v4,0
</span></span><span style="display:flex;"><span>293e	vsetvli	a5,a3,e8,mf8,ta,ma
</span></span><span style="display:flex;"><span>2942	vle8.v	v0,(a2)
</span></span><span style="display:flex;"><span>2946	vmv1r.v	v1,v4
</span></span><span style="display:flex;"><span>294a	slli	a6,a5,0x4
</span></span><span style="display:flex;"><span>294e	slli	a4,a5,0x3
</span></span><span style="display:flex;"><span>2952	sub	a3,a3,a5
</span></span><span style="display:flex;"><span>2954	add	a2,a2,a5
</span></span><span style="display:flex;"><span>2956	vmsne.vi	v0,v0,0
</span></span><span style="display:flex;"><span>295a	vlseg2e64.v	v2,(a1),v0.t
</span></span><span style="display:flex;"><span>295e	vsetvli	zero,zero,e64,m1,tu,mu
</span></span><span style="display:flex;"><span>2962	add	a1,a1,a6
</span></span><span style="display:flex;"><span>2964	vfadd.vv	v1,v3,v2,v0.t
</span></span><span style="display:flex;"><span>2968	vse64.v	v1,(a0),v0.t
</span></span><span style="display:flex;"><span>296c	add	a0,a0,a4
</span></span><span style="display:flex;"><span>296e	bnez	a3,293e &lt;test_f64_f64_i8_2+0xc&gt;
</span></span><span style="display:flex;"><span>2970	ret	
</span></span></code></pre></div><h2 id="manual-analysis">Manual analysis</h2>
<p>The matched C code is not that good a match.  The Advisor suggests that this is a floating point add
reduction loop over 32-bit floats into a 64 bit double result, with a relatively complex indexing calculation
to access the addends.</p>
<p>The path forward is to add custom training examples until we converge on a decent match.  We can do that by adding
a new training function to the database:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">#include</span> <span style="color:#8f5902;font-style:italic">&lt;stdint.h&gt;</span><span style="color:#8f5902;font-style:italic">
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span><span style="color:#204a87;font-weight:bold">double</span> <span style="color:#000">reduce_floats</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">float</span> <span style="color:#ce5c00;font-weight:bold">*</span><span style="color:#000">p</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#204a87;font-weight:bold">uint32_t</span> <span style="color:#000">count</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">double</span> <span style="color:#000">result</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">0.0</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">for</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">int</span> <span style="color:#000">i</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#000">i</span> <span style="color:#ce5c00;font-weight:bold">&lt;</span> <span style="color:#000">count</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#000">i</span><span style="color:#ce5c00;font-weight:bold">++</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">result</span> <span style="color:#ce5c00;font-weight:bold">+=</span> <span style="color:#000">p</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">i</span> <span style="color:#ce5c00;font-weight:bold">*</span> <span style="color:#0000cf;font-weight:bold">14</span><span style="color:#000;font-weight:bold">];</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">return</span> <span style="color:#000">result</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div><p>Rebuild the database with <code>generator.py</code>, <code>ingest.py</code>, and <code>sample_analytics.py</code>.  We can then rerun the Advisor - but we don&rsquo;t get a better match!
In fact compiling this training example with <code>GCC 15.0</code>, <code>-O3</code>, and <code>-march=rv64gcv</code> doesn&rsquo;t produce any vector instructions at all.
We need to add one more compilation option, <code>-ffast-math</code>, to convince the compiler that vectorization is desired.</p>
<p>After adding <code>-ffast-math</code> to the relevant <code>BUILD</code> file, we get a much better Advisor output:</p>
<h2 id="advisor-output---with-fast-math">Advisor Output - with fast-math</h2>
<h3 id="similarity-analysis-1">Similarity Analysis</h3>
<p>Compare the clipped example to the database of vectorized examples.</p>
<p>The best match is id=1532 [0.957]= bnez,vfmv.f.s,vfmv.s.f,vfredusum.vs,vfwadd.wv,vid.v,vluxei64.v,vmul.vx,vmv.v.i,vmv1r.v,vsetvli,vsetvli,vsetvli,vsll.vi</p>
<p>The clip is similar to the reference example <code>data/custom_testsuite/structs/reduction_rv64gcv:reduce_floats</code></p>
<h2 id="notes">Notes</h2>
<ul>
<li>
<p>The <code>whisper.cpp</code> binary was compiled with <code>-O3</code> and <code>-ffast-math</code>.  This is an example of iteratively reconstructing the toolchain
until we can generate something close to the observed code.</p>
</li>
<li>
<p>The actual C source likely does not contain anything like <code>p[i * 14]</code>.  It is much more likely to be iterating over an array of
structs, each 56 bytes long, and summing a 32 bit count field within that structure.</p>
</li>
<li>
<p>There likely isn&rsquo;t much of a gain to be had with vectorizing this loop if VLEN is 128 bits.  Only two elements can be
processed per iteration, with 10 instructions per iteration.  The scalar code handles one element per iteration in five instructions,
so any possible gain is due to a tradeoff between code size and branch handling.</p>
<h2 id="reconciling-with-ghidra">Reconciling with Ghidra</h2>
<p>This reduction example decomposes the loop into three segments:</p>
<ol>
<li>A setup section before the loop initializing:
<ul>
<li>a double result vector <code>v1</code> to zero</li>
<li>a pointer to the first addend in <code>a2</code>,</li>
<li>a vector of relative offsets <code>v1 = (0, 1, ...) * 0x38</code></li>
</ul>
</li>
<li>The loop body:
<ul>
<li><code>a5</code> = number of addends that fit into a vector register</li>
<li><code>v2</code> = an indexed load of addends</li>
<li><code>v1 += v2</code></li>
<li><code>a4 = 0x38 * a5</code></li>
<li><code>a2 += a4</code>  ; adjust the address of the next first addend</li>
</ul>
</li>
<li>The loop post-processing
<ul>
<li><code>v2 = 0.0</code></li>
<li><code>v1[0] = v2[0] +/v1</code>  ; where <code>+/</code> sums the elements of a single vector into the first element of the result vector</li>
<li><code>fs1 = v1[0]</code></li>
</ul>
</li>
</ol>
</li>
</ul>
<p>The original C code might look like this:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">struct</span> <span style="color:#000">astruct</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>  <span style="color:#204a87;font-weight:bold">uint32_t</span> <span style="color:#000">field0x00</span><span style="color:#000;font-weight:bold">[</span><span style="color:#0000cf;font-weight:bold">3</span><span style="color:#000;font-weight:bold">];</span>
</span></span><span style="display:flex;"><span>  <span style="color:#204a87;font-weight:bold">float</span>    <span style="color:#000">field0x0c</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#204a87;font-weight:bold">uint32_t</span> <span style="color:#000">field0x10</span><span style="color:#000;font-weight:bold">[</span><span style="color:#0000cf;font-weight:bold">10</span><span style="color:#000;font-weight:bold">];</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">};</span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">// sizeof astruct = 0x38
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span><span style="color:#204a87;font-weight:bold">double</span> <span style="color:#000">reduce_floats</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">struct</span> <span style="color:#000">astruct</span><span style="color:#ce5c00;font-weight:bold">*</span> <span style="color:#000">p</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#204a87;font-weight:bold">uint32_t</span> <span style="color:#000">count</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">double</span> <span style="color:#000">result</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">0.0</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">for</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">int</span> <span style="color:#000">i</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#000">i</span> <span style="color:#ce5c00;font-weight:bold">&lt;</span> <span style="color:#000">count</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#000">i</span><span style="color:#ce5c00;font-weight:bold">++</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">result</span> <span style="color:#ce5c00;font-weight:bold">+=</span> <span style="color:#000">p</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">i</span><span style="color:#000;font-weight:bold">].</span><span style="color:#000">count</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">return</span> <span style="color:#000">result</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div>
</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-b7fe35a883aba80b94da14f1a7088bd6">1.2 - DPDK Network Example</h1>
    
	<p>Are network appliances improved with autovectorization?  We can examine code examples taken from the
DPDK network project to find out.
We&rsquo;ll start with code that uses vector gather and slide operations in what <em>might</em> be a key datapath routine.
The binary <code>dpdk_l3fwd</code> is an example of a layer 3 forwarding engine.  It includes the function <code>rx_recv_pkts</code>,
which appears to be selected from the DPDK source file <code>drivers/net/iavf/iavf_rxtx.c</code>.</p>
<p>This function includes several vector stanzas that use <code>vrgather</code> and <code>vslide1down</code>.</p>
<p>We will make things a bit easier by including the preprocessed source file <code>drivers/net/iavf/iavf_rxtx.c</code>
in our custom dataset under <code>data/custom_testsuite/dpdk</code>.  This brings all of the relevant DPDK header files
inline.</p>
<p>The first vector stanza to examine is:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>LAB_0053c12e             XREF[2]:     0053be34(j), 0053be42(j)  
</span></span><span style="display:flex;"><span>0053c12e 73 2e 20 c2     csrrs        t3,vlenb,zero
</span></span><span style="display:flex;"><span>0053c132 57 73 80 0d     vsetvli      t1,zero,e64,m1,ta,ma 
</span></span><span style="display:flex;"><span>0053c136 b3 0e c0 41     neg          t4,t3
</span></span><span style="display:flex;"><span>0053c13a 93 58 3e 00     srli         a7,t3,0x3
</span></span><span style="display:flex;"><span>0053c13e 3e 97           c.add        a4,a5
</span></span><span style="display:flex;"><span>0053c140 d7 a1 08 52     vid.v        v3
</span></span><span style="display:flex;"><span>0053c144 93 87 0e 04     addi         a5,t4,0x40
</span></span><span style="display:flex;"><span>0053c148 93 86 f8 ff     addi         a3,a7,-0x1
</span></span><span style="display:flex;"><span>0053c14c 33 67 f7 20     sh3add       a4,a4,a5
</span></span><span style="display:flex;"><span>0053c150 d7 c1 36 0e     vrsub.vx     v3,v3,a3
</span></span><span style="display:flex;"><span>0053c154 5a 97           c.add        a4,s6
</span></span><span style="display:flex;"><span>0053c156 3b 8f 1b 41     subw         t5,s7,a7
</span></span><span style="display:flex;"><span>0053c15a a2 86           c.mv         a3,s0
</span></span><span style="display:flex;"><span>0053c15c 81 47           c.li         a5,0x0
</span></span><span style="display:flex;"><span>LAB_0053c15e             XREF[1]:     0053c172(j)  
</span></span><span style="display:flex;"><span>0053c15e 07 71 87 02     vl1re64.v    v2,(a4)
</span></span><span style="display:flex;"><span>0053c162 bb 87 17 01     addw         a5,a5,a7
</span></span><span style="display:flex;"><span>0053c166 76 97           c.add        a4,t4
</span></span><span style="display:flex;"><span>0053c168 d7 80 21 32     vrgather.vv  v1,v2,v3
</span></span><span style="display:flex;"><span>0053c16c a7 80 86 02     vs1r.v       v1,(a3)
</span></span><span style="display:flex;"><span>0053c170 f2 96           c.add        a3,t3
</span></span><span style="display:flex;"><span>0053c172 e3 76 ff fe     bgeu         t5,a5,LAB_0053c15e
</span></span></code></pre></div><p>This sequence suggests a load/permute/store operation on 64 bit elements.  There are lots of complications:</p>
<ul>
<li>The function <code>rx_recv_pkts</code> has static inline attributes, so it has likely been merged with other functions</li>
<li>There are no obvious candidates for the gcc C source code that generates this <code>vrgather</code> pattern.</li>
<li>This may be an artifact of using snapshots of gcc and dpdk.</li>
<li>The <code>vs1r.v</code> instruction is a whole register store variant that ignores <code>vsetvli</code> settings.</li>
</ul>
<p>Analysis of this snippet is easier with emulation:</p>
<ul>
<li>The assembly fragment is copied into a new source file, <code>emulations/test_1.S</code></li>
<li>The assembly source is converted into a subroutine</li>
<li>Instrumentation is added to store intermediate values into global data variables.</li>
<li>A <code>main.c</code> driver routine is added, to provide input and output vectors and
instrumentation printouts.</li>
<li>A RISCV-64 executable is built</li>
<li>A RISCV-64 QEMU userspace emulator is built and configured</li>
<li>The RISCV-64 executable is run to see what permutations are generated</li>
<li>The RISCV-64 executable is run with alternate values for VLEN, to show that the results
are stable regardless of the vector hardware implementation.</li>
</ul>
<p>Process this Ghidra assembly fragment through the current Advisor:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-md" data-lang="md"><span style="display:flex;"><span>Signatures:
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">*</span> Element width is = 64 bits
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">*</span> Vector element index: vid.v
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">*</span> often used in generating a vector of offsets for indexing
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">*</span> Vector whole register load: vl1re64.v
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">*</span> Vector gather: vrgather.vv
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">*</span> Vector whole register(s) store: vs1r.v
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">*</span> Significant opcodes, in the order they appear:
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">*</span> vsetvli,vid.v,vrsub.vx,vl1re64.v,vrgather.vv,vs1r.v,bgeu
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">*</span> Significant opcodes, in alphanumeric order:
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">*</span> bgeu,vid.v,vl1re64.v,vrgather.vv,vrsub.vx,vs1r.v,vsetvli
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">*</span> At least one loop exists
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#800080;font-weight:bold">## Similarity Analysis
</span></span></span><span style="display:flex;"><span><span style="color:#800080;font-weight:bold"></span>
</span></span><span style="display:flex;"><span>Compare the clipped example to the database of vectorized examples.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>The best match is id=1689 [0.860]= vid.v,vle16.v,vrgather.vv,vrsub.vi,vse16.v,vsetivli
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>The clip is similar to the reference example <span style="color:#4e9a06">`data/gcc_riscv_testsuite/rvv/autovec/vls-vlmax/perm-4_rv64gcv:permute_vnx2hi`</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#800080;font-weight:bold">### Reference C Source
</span></span></span><span style="display:flex;"><span><span style="color:#800080;font-weight:bold"></span>
</span></span><span style="display:flex;"><span>void permute_vnx2hi(vnx2hi values1, vnx2hi values2, vnx2hi *out)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  vnx2hi v = __builtin_shufflevector (values1, values2, (2) - 1 - (0), (2) - 2 - (0));
</span></span><span style="display:flex;"><span>  <span style="color:#000;font-style:italic">*(vnx2hi *</span>) out = v;
</span></span><span style="display:flex;"><span>} <span style="color:#000;font-weight:bold">__attribute__</span>((noipa))
</span></span></code></pre></div><p>Gcc&rsquo;s <code>__builtin_shufflevector</code> with the given mask reverses the order of a vector of two 16 bit values.
The signature match of 0.86 suggests this is just a hint of what is going on here.</p>
<p>After rewriting the Ghidra sample as a riscv64 assembly routine, we get:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-as" data-lang="as"><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">.</span><span style="color:#000">section</span> <span style="color:#000;font-weight:bold">.</span><span style="color:#000">data</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">test_1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">.</span><span style="color:#000">globl</span> <span style="color:#000">cntr</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#000">vl</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#000">src_incr</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#000">dst_incr</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#000">src_start</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#000">dst_start</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">.</span><span style="color:#000">globl</span> <span style="color:#000">cnt_limit</span>
</span></span><span style="display:flex;"><span><span style="color:#000">dst_incr</span><span style="color:#ce5c00;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">.</span><span style="color:#000">dword</span>  <span style="color:#0000cf;font-weight:bold">0</span>
</span></span><span style="display:flex;"><span><span style="color:#000">vl</span><span style="color:#ce5c00;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">.</span><span style="color:#000">dword</span>  <span style="color:#0000cf;font-weight:bold">0</span>
</span></span><span style="display:flex;"><span><span style="color:#000">src_incr</span><span style="color:#ce5c00;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">.</span><span style="color:#000">dword</span>  <span style="color:#0000cf;font-weight:bold">0</span>
</span></span><span style="display:flex;"><span><span style="color:#000">cntr</span><span style="color:#ce5c00;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">.</span><span style="color:#000">dword</span>  <span style="color:#0000cf;font-weight:bold">0</span>
</span></span><span style="display:flex;"><span><span style="color:#000">src_start</span><span style="color:#ce5c00;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">.</span><span style="color:#000">dword</span>  <span style="color:#0000cf;font-weight:bold">0</span>
</span></span><span style="display:flex;"><span><span style="color:#000">dst_start</span><span style="color:#ce5c00;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">.</span><span style="color:#000">dword</span>  <span style="color:#0000cf;font-weight:bold">0</span>
</span></span><span style="display:flex;"><span><span style="color:#000">cnt_limit</span><span style="color:#ce5c00;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">.</span><span style="color:#000">word</span>  <span style="color:#0000cf;font-weight:bold">0</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">.</span><span style="color:#000">section</span>        <span style="color:#000;font-weight:bold">.</span><span style="color:#000">text</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">test_1</span><span style="color:#ce5c00;font-weight:bold">,</span><span style="color:#4e9a06">&#34;ax&#34;</span><span style="color:#ce5c00;font-weight:bold">,</span><span style="color:#a40000">@</span><span style="color:#000">progbits</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">.</span><span style="color:#000">globl</span> <span style="color:#000">test_1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">.</span><span style="color:#000">type</span>  <span style="color:#000">test_1</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#a40000">@</span><span style="color:#204a87;font-weight:bold">function</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000">test_1</span><span style="color:#ce5c00;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">csrrs</span>          <span style="color:#000">t3</span><span style="color:#ce5c00;font-weight:bold">,</span><span style="color:#000">vlenb</span><span style="color:#ce5c00;font-weight:bold">,</span><span style="color:#000">zero</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">lui</span>            <span style="color:#000">t6</span><span style="color:#ce5c00;font-weight:bold">,%</span><span style="color:#000">hi</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">dst_incr</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">addi</span>           <span style="color:#000">t6</span><span style="color:#ce5c00;font-weight:bold">,</span><span style="color:#000">t6</span><span style="color:#ce5c00;font-weight:bold">,%</span><span style="color:#000">lo</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">dst_incr</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">sd</span>             <span style="color:#000">t3</span><span style="color:#ce5c00;font-weight:bold">,</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">t6</span><span style="color:#000;font-weight:bold">)</span>                <span style="color:#a40000">#</span> <span style="color:#ce5c00;font-weight:bold">-&gt;</span><span style="color:#000">dst_incr</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">vsetvli</span>        <span style="color:#000">t1</span><span style="color:#ce5c00;font-weight:bold">,</span><span style="color:#000">zero</span><span style="color:#ce5c00;font-weight:bold">,</span><span style="color:#000">e64</span><span style="color:#ce5c00;font-weight:bold">,</span><span style="color:#000">m1</span><span style="color:#ce5c00;font-weight:bold">,</span><span style="color:#000">ta</span><span style="color:#ce5c00;font-weight:bold">,</span><span style="color:#000">ma</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">sd</span>             <span style="color:#000">t1</span><span style="color:#ce5c00;font-weight:bold">,</span><span style="color:#0000cf;font-weight:bold">8</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">t6</span><span style="color:#000;font-weight:bold">)</span>               <span style="color:#a40000">#</span> <span style="color:#ce5c00;font-weight:bold">-&gt;</span><span style="color:#000">vl</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">neg</span>            <span style="color:#000">t4</span><span style="color:#ce5c00;font-weight:bold">,</span><span style="color:#000">t3</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">sd</span>             <span style="color:#000">t4</span><span style="color:#ce5c00;font-weight:bold">,</span><span style="color:#0000cf;font-weight:bold">16</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">t6</span><span style="color:#000;font-weight:bold">)</span>              <span style="color:#a40000">#</span> <span style="color:#ce5c00;font-weight:bold">-&gt;</span><span style="color:#000">src_incr</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">srli</span>           <span style="color:#000">a7</span><span style="color:#ce5c00;font-weight:bold">,</span><span style="color:#000">t3</span><span style="color:#ce5c00;font-weight:bold">,</span><span style="color:#0000cf;font-weight:bold">0x3</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">sd</span>             <span style="color:#000">a7</span><span style="color:#ce5c00;font-weight:bold">,</span><span style="color:#0000cf;font-weight:bold">24</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">t6</span><span style="color:#000;font-weight:bold">)</span>              <span style="color:#a40000">#</span> <span style="color:#ce5c00;font-weight:bold">-&gt;</span><span style="color:#000">cntr</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">vid</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">v</span>          <span style="color:#000">v3</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">addi</span>           <span style="color:#000">a5</span><span style="color:#ce5c00;font-weight:bold">,</span><span style="color:#000">t4</span><span style="color:#ce5c00;font-weight:bold">,</span><span style="color:#0000cf;font-weight:bold">0x40</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">addi</span>           <span style="color:#000">a3</span><span style="color:#ce5c00;font-weight:bold">,</span><span style="color:#000">a7</span><span style="color:#ce5c00;font-weight:bold">,-</span><span style="color:#0000cf;font-weight:bold">0x1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">add</span>            <span style="color:#000">a0</span><span style="color:#ce5c00;font-weight:bold">,</span><span style="color:#000">a5</span><span style="color:#ce5c00;font-weight:bold">,</span><span style="color:#000">a0</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">sd</span>             <span style="color:#000">a0</span><span style="color:#ce5c00;font-weight:bold">,</span><span style="color:#0000cf;font-weight:bold">32</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">t6</span><span style="color:#000;font-weight:bold">)</span>              <span style="color:#a40000">#</span> <span style="color:#ce5c00;font-weight:bold">-&gt;</span><span style="color:#000">src_start</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">vrsub</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">vx</span>       <span style="color:#000">v3</span><span style="color:#ce5c00;font-weight:bold">,</span><span style="color:#000">v3</span><span style="color:#ce5c00;font-weight:bold">,</span><span style="color:#000">a3</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">c</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">li</span>           <span style="color:#000">t5</span><span style="color:#ce5c00;font-weight:bold">,</span><span style="color:#0000cf;font-weight:bold">0x8</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">subw</span>           <span style="color:#000">t5</span><span style="color:#ce5c00;font-weight:bold">,</span><span style="color:#000">t5</span><span style="color:#ce5c00;font-weight:bold">,</span><span style="color:#000">a7</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">sw</span>             <span style="color:#000">t5</span><span style="color:#ce5c00;font-weight:bold">,</span><span style="color:#0000cf;font-weight:bold">48</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">t6</span><span style="color:#000;font-weight:bold">)</span>              <span style="color:#a40000">#</span> <span style="color:#ce5c00;font-weight:bold">-&gt;</span><span style="color:#000">cnt_limit</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">vs1r</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">v</span>         <span style="color:#000">v3</span><span style="color:#ce5c00;font-weight:bold">,</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">a2</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">c</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">li</span>           <span style="color:#000">a5</span><span style="color:#ce5c00;font-weight:bold">,</span><span style="color:#0000cf;font-weight:bold">0x0</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">sd</span>             <span style="color:#000">a1</span><span style="color:#ce5c00;font-weight:bold">,</span><span style="color:#0000cf;font-weight:bold">40</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">t6</span><span style="color:#000;font-weight:bold">)</span>              <span style="color:#a40000">#</span> <span style="color:#ce5c00;font-weight:bold">-&gt;</span><span style="color:#000">dst_start</span>
</span></span><span style="display:flex;"><span><span style="color:#000">LAB_0053c15e</span><span style="color:#ce5c00;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">vl1re64</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">v</span>      <span style="color:#000">v2</span><span style="color:#ce5c00;font-weight:bold">,</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">a0</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">addw</span>           <span style="color:#000">a5</span><span style="color:#ce5c00;font-weight:bold">,</span><span style="color:#000">a5</span><span style="color:#ce5c00;font-weight:bold">,</span><span style="color:#000">a7</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">c</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">add</span>          <span style="color:#000">a0</span><span style="color:#ce5c00;font-weight:bold">,</span><span style="color:#000">t4</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">vrgather</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">vv</span>    <span style="color:#000">v1</span><span style="color:#ce5c00;font-weight:bold">,</span><span style="color:#000">v2</span><span style="color:#ce5c00;font-weight:bold">,</span><span style="color:#000">v3</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">vs1r</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">v</span>         <span style="color:#000">v1</span><span style="color:#ce5c00;font-weight:bold">,</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">a1</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">add</span>            <span style="color:#000">a1</span><span style="color:#ce5c00;font-weight:bold">,</span><span style="color:#000">a1</span><span style="color:#ce5c00;font-weight:bold">,</span><span style="color:#000">t3</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">bgeu</span>           <span style="color:#000">t5</span><span style="color:#ce5c00;font-weight:bold">,</span><span style="color:#000">a5</span><span style="color:#ce5c00;font-weight:bold">,</span><span style="color:#000">LAB_0053c15e</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">ret</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">globl</span> <span style="color:#000">get_vlenb</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">type</span>  <span style="color:#000">get_vlanb</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#a40000">@</span><span style="color:#204a87;font-weight:bold">function</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000">get_vlanb</span><span style="color:#ce5c00;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">csrrs</span>          <span style="color:#000">a0</span><span style="color:#ce5c00;font-weight:bold">,</span><span style="color:#000">vlenb</span><span style="color:#ce5c00;font-weight:bold">,</span><span style="color:#000">zero</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">srli</span>           <span style="color:#000">a2</span><span style="color:#ce5c00;font-weight:bold">,</span><span style="color:#000">a0</span><span style="color:#ce5c00;font-weight:bold">,</span><span style="color:#0000cf;font-weight:bold">0x3</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">ret</span>
</span></span></code></pre></div><p>The main routine to exercise this is:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">#include</span> <span style="color:#8f5902;font-style:italic">&lt;stdio.h&gt;</span><span style="color:#8f5902;font-style:italic">
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span><span style="color:#204a87;font-weight:bold">extern</span> <span style="color:#204a87;font-weight:bold">void</span> <span style="color:#000">test_1</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">unsigned</span> <span style="color:#204a87;font-weight:bold">long</span> <span style="color:#204a87;font-weight:bold">long</span> <span style="color:#ce5c00;font-weight:bold">*</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#204a87;font-weight:bold">unsigned</span> <span style="color:#204a87;font-weight:bold">long</span> <span style="color:#204a87;font-weight:bold">long</span> <span style="color:#ce5c00;font-weight:bold">*</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#204a87;font-weight:bold">unsigned</span> <span style="color:#204a87;font-weight:bold">long</span> <span style="color:#204a87;font-weight:bold">long</span> <span style="color:#ce5c00;font-weight:bold">*</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">extern</span> <span style="color:#204a87;font-weight:bold">void</span> <span style="color:#000">test_1_ref</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">unsigned</span> <span style="color:#204a87;font-weight:bold">long</span> <span style="color:#204a87;font-weight:bold">long</span> <span style="color:#ce5c00;font-weight:bold">*</span><span style="color:#000">in</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#204a87;font-weight:bold">unsigned</span> <span style="color:#204a87;font-weight:bold">long</span> <span style="color:#204a87;font-weight:bold">long</span> <span style="color:#ce5c00;font-weight:bold">*</span><span style="color:#000">out</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#204a87;font-weight:bold">unsigned</span> <span style="color:#204a87;font-weight:bold">int</span> <span style="color:#000">size</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">extern</span> <span style="color:#204a87;font-weight:bold">long</span> <span style="color:#204a87;font-weight:bold">long</span> <span style="color:#000">cntr</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">vl</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">src_incr</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">dst_incr</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">src_start</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">dst_start</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">extern</span> <span style="color:#204a87;font-weight:bold">long</span> <span style="color:#000">cnt_limit</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">int</span> <span style="color:#000">main</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">void</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">unsigned</span> <span style="color:#204a87;font-weight:bold">long</span> <span style="color:#204a87;font-weight:bold">long</span> <span style="color:#000">in_vector</span><span style="color:#000;font-weight:bold">[</span><span style="color:#0000cf;font-weight:bold">8</span><span style="color:#000;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">{</span><span style="color:#0000cf;font-weight:bold">90</span><span style="color:#000;font-weight:bold">,</span><span style="color:#0000cf;font-weight:bold">91</span><span style="color:#000;font-weight:bold">,</span><span style="color:#0000cf;font-weight:bold">92</span><span style="color:#000;font-weight:bold">,</span><span style="color:#0000cf;font-weight:bold">93</span><span style="color:#000;font-weight:bold">,</span><span style="color:#0000cf;font-weight:bold">94</span><span style="color:#000;font-weight:bold">,</span><span style="color:#0000cf;font-weight:bold">95</span><span style="color:#000;font-weight:bold">,</span><span style="color:#0000cf;font-weight:bold">96</span><span style="color:#000;font-weight:bold">,</span><span style="color:#0000cf;font-weight:bold">97</span><span style="color:#000;font-weight:bold">};</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">unsigned</span> <span style="color:#204a87;font-weight:bold">long</span> <span style="color:#204a87;font-weight:bold">long</span> <span style="color:#000">out_vector</span><span style="color:#000;font-weight:bold">[</span><span style="color:#0000cf;font-weight:bold">8</span><span style="color:#000;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">{</span><span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">,</span><span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">,</span><span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">,</span><span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">,</span><span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">,</span><span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">,</span><span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">,</span><span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">};</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">unsigned</span> <span style="color:#204a87;font-weight:bold">long</span> <span style="color:#204a87;font-weight:bold">long</span> <span style="color:#000">shuffle_vector</span><span style="color:#000;font-weight:bold">[</span><span style="color:#0000cf;font-weight:bold">4</span><span style="color:#000;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">{</span><span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">,</span><span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">,</span><span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">,</span><span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">};</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">printf</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;Initializing</span><span style="color:#4e9a06">\n</span><span style="color:#4e9a06">&#34;</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">printf</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;in_vector_addr: %16p</span><span style="color:#4e9a06">\n</span><span style="color:#4e9a06">&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">void</span><span style="color:#ce5c00;font-weight:bold">*</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000">in_vector</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">printf</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;out_vector_addr: %16p</span><span style="color:#4e9a06">\n</span><span style="color:#4e9a06">&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">void</span><span style="color:#ce5c00;font-weight:bold">*</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000">out_vector</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">test_1</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">in_vector</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">out_vector</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">shuffle_vector</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">printf</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;cntr: %lld</span><span style="color:#4e9a06">\n</span><span style="color:#4e9a06">&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">cntr</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">printf</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;vl: %lld</span><span style="color:#4e9a06">\n</span><span style="color:#4e9a06">&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">vl</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">printf</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;src_incr: 0x%llx</span><span style="color:#4e9a06">\n</span><span style="color:#4e9a06">&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">src_incr</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">printf</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;dst_incr: 0x%llx</span><span style="color:#4e9a06">\n</span><span style="color:#4e9a06">&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">dst_incr</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">printf</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;src_start: %p</span><span style="color:#4e9a06">\n</span><span style="color:#4e9a06">&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">void</span><span style="color:#ce5c00;font-weight:bold">*</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000">src_start</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">printf</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;dst_start: %p</span><span style="color:#4e9a06">\n</span><span style="color:#4e9a06">&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">void</span><span style="color:#ce5c00;font-weight:bold">*</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000">dst_start</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">printf</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;cnt_limit: 0x%lx</span><span style="color:#4e9a06">\n</span><span style="color:#4e9a06">&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">cnt_limit</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">printf</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;shuffle vector: %lld, %lld, %lld, %lld</span><span style="color:#4e9a06">\n</span><span style="color:#4e9a06">&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">shuffle_vector</span><span style="color:#000;font-weight:bold">[</span><span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">],</span> <span style="color:#000">shuffle_vector</span><span style="color:#000;font-weight:bold">[</span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">],</span> <span style="color:#000">shuffle_vector</span><span style="color:#000;font-weight:bold">[</span><span style="color:#0000cf;font-weight:bold">2</span><span style="color:#000;font-weight:bold">],</span> <span style="color:#000">shuffle_vector</span><span style="color:#000;font-weight:bold">[</span><span style="color:#0000cf;font-weight:bold">3</span><span style="color:#000;font-weight:bold">]);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">printf</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;out vector: %lld, %lld, %lld, %lld, &#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">out_vector</span><span style="color:#000;font-weight:bold">[</span><span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">],</span> <span style="color:#000">out_vector</span><span style="color:#000;font-weight:bold">[</span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">],</span> <span style="color:#000">out_vector</span><span style="color:#000;font-weight:bold">[</span><span style="color:#0000cf;font-weight:bold">2</span><span style="color:#000;font-weight:bold">],</span> <span style="color:#000">out_vector</span><span style="color:#000;font-weight:bold">[</span><span style="color:#0000cf;font-weight:bold">3</span><span style="color:#000;font-weight:bold">]);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">printf</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;%lld, %lld, %lld, %lld</span><span style="color:#4e9a06">\n</span><span style="color:#4e9a06">&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">out_vector</span><span style="color:#000;font-weight:bold">[</span><span style="color:#0000cf;font-weight:bold">4</span><span style="color:#000;font-weight:bold">],</span> <span style="color:#000">out_vector</span><span style="color:#000;font-weight:bold">[</span><span style="color:#0000cf;font-weight:bold">5</span><span style="color:#000;font-weight:bold">],</span> <span style="color:#000">out_vector</span><span style="color:#000;font-weight:bold">[</span><span style="color:#0000cf;font-weight:bold">6</span><span style="color:#000;font-weight:bold">],</span> <span style="color:#000">out_vector</span><span style="color:#000;font-weight:bold">[</span><span style="color:#0000cf;font-weight:bold">7</span><span style="color:#000;font-weight:bold">]);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">printf</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;Assembly version Complete, starting reference version</span><span style="color:#4e9a06">\n</span><span style="color:#4e9a06">&#34;</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8f5902;font-style:italic">/* Once the assembly mockup returns a good value, try a C equivalent
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">    test_1_ref(in_vector, out_vector, 8);
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">    printf(&#34;out vector: %lld, %lld, %lld, %lld, &#34;, out_vector[0], out_vector[1], out_vector[2], out_vector[3]);
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">    printf(&#34;%lld, %lld, %lld, %lld\n&#34;, out_vector[4], out_vector[5], out_vector[6], out_vector[7]);
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">    */</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div><p>The QEMU VLEN variable and microarchitecture extensions are configured on the command line.
The following requests the VLEN=128 minimum basic register size.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-console" data-lang="console"><span style="display:flex;"><span><span style="color:#8f5902">$</span> <span style="color:#204a87">export</span> <span style="color:#000">QEMU_CPU</span><span style="color:#ce5c00;font-weight:bold">=</span>rv64,zba<span style="color:#ce5c00;font-weight:bold">=</span>true,zbb<span style="color:#ce5c00;font-weight:bold">=</span>true,v<span style="color:#ce5c00;font-weight:bold">=</span>true,vlen<span style="color:#ce5c00;font-weight:bold">=</span>128,vext_spec<span style="color:#ce5c00;font-weight:bold">=</span>v1.0,rvv_ta_all_1s<span style="color:#ce5c00;font-weight:bold">=</span>true,rvv_ma_all_1s<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87">true</span>
</span></span></code></pre></div><p>Build and run with:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-console" data-lang="console"><span style="display:flex;"><span><span style="color:#000;font-style:italic">training_set$ bazel build --platforms=//platforms:riscv_gcc emulations:test_1
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">INFO: Analyzed target //emulations:test_1 (0 packages loaded, 0 targets configured).
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">INFO: Found 1 target...
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">Target //emulations:test_1 up-to-date:
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">  bazel-bin/emulations/test_1
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic"></span><span style="color:#a40000">
</span></span></span><span style="display:flex;"><span><span style="color:#a40000"></span><span style="color:#000;font-style:italic">training_set$ qemu-riscv64-static -L /opt/riscvx/sysroot -E LD_LIBRARY_PATH=/opt/riscvx/sysroot/riscv64-unknown-linux-gnu/lib/ bazel-bin/emulations/test_1
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">Initializing
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">in_vector_addr:   0x2aaaab2aaab0
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">out_vector_addr:   0x2aaaab2aaaf0
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">cntr: 2
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">vl: 2
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">src_incr: 0xfffffffffffffff0
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">dst_incr: 0x10
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">src_start: 0x2aaaab2aaae0
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">dst_start: 0x2aaaab2aaaf0
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">cnt_limit: 0x6
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">shuffle vector: 1, 0, 0, 0
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">out vector: 97, 96, 95, 94, 93, 92, 91, 90
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">Complete!
</span></span></span></code></pre></div><p>Repeat with VLEN=256 and the same executable binary, to see if the results are stable:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-console" data-lang="console"><span style="display:flex;"><span><span style="color:#8f5902">$</span> <span style="color:#204a87">export</span> <span style="color:#000">QEMU_CPU</span><span style="color:#ce5c00;font-weight:bold">=</span>rv64,zba<span style="color:#ce5c00;font-weight:bold">=</span>true,zbb<span style="color:#ce5c00;font-weight:bold">=</span>true,v<span style="color:#ce5c00;font-weight:bold">=</span>true,vlen<span style="color:#ce5c00;font-weight:bold">=</span>256,vext_spec<span style="color:#ce5c00;font-weight:bold">=</span>v1.0,rvv_ta_all_1s<span style="color:#ce5c00;font-weight:bold">=</span>true,rvv_ma_all_1s<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87">true</span>
</span></span><span style="display:flex;"><span><span style="color:#a40000">
</span></span></span><span style="display:flex;"><span><span style="color:#a40000"></span><span style="color:#000;font-style:italic">training_set$ qemu-riscv64-static -L /opt/riscvx/sysroot -E LD_LIBRARY_PATH=/opt/riscvx/sysroot/riscv64-unknown-linux-gnu/lib/ bazel-bin/emulations/test_1
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">Initializing
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">in_vector_addr:   0x2aaaab2aaab0
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">out_vector_addr:   0x2aaaab2aaaf0
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">cntr: 4
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">vl: 4
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">src_incr: 0xffffffffffffffe0
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">dst_incr: 0x20
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">src_start: 0x2aaaab2aaad0
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">dst_start: 0x2aaaab2aaaf0
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">cnt_limit: 0x4
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">shuffle vector: 3, 2, 1, 0
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">out vector: 97, 96, 95, 94, 93, 92, 91, 90
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">Complete!
</span></span></span></code></pre></div><p>So now the permutation is clear - this snippet copies a vector of 64 bit values - likely pointers - from one location to another <em>in the reverse order</em>.
The source pointer advances backwards, starting <code>vl</code> elements before the end, while the
destination pointer advances forwards, starting at the first element.  The reverse-copy
operation is stable with VLEN of 128 or 256 bits.</p>
<p>Next we can add <code>test_1_ref.c</code>, a C routine which should compile to something much closer to the
sample binary:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">void</span> <span style="color:#000">test_1_ref</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">unsigned</span> <span style="color:#204a87;font-weight:bold">long</span> <span style="color:#204a87;font-weight:bold">long</span> <span style="color:#ce5c00;font-weight:bold">*</span><span style="color:#000">in</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#204a87;font-weight:bold">unsigned</span> <span style="color:#204a87;font-weight:bold">long</span> <span style="color:#204a87;font-weight:bold">long</span> <span style="color:#ce5c00;font-weight:bold">*</span><span style="color:#000">out</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#204a87;font-weight:bold">unsigned</span> <span style="color:#204a87;font-weight:bold">int</span> <span style="color:#000">size</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">int</span> <span style="color:#000">i</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">int</span> <span style="color:#000">upper_index</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">size</span> <span style="color:#ce5c00;font-weight:bold">-</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">for</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#000">i</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#000">i</span> <span style="color:#ce5c00;font-weight:bold">&lt;</span> <span style="color:#000">size</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#000">i</span><span style="color:#ce5c00;font-weight:bold">++</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">out</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">i</span><span style="color:#000;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">in</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">upper_index</span> <span style="color:#ce5c00;font-weight:bold">-</span> <span style="color:#000">i</span><span style="color:#000;font-weight:bold">];</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div><h2 id="record-the-new-example">Record the new example</h2>
<p>We want to add <code>test_1_ref</code> to the training set database, so copy it into <code>custom_testsuite/structs</code>, update the
BUILD file there, then rerun the analysis:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-console" data-lang="console"><span style="display:flex;"><span><span style="color:#000;font-style:italic">./generator.py 
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">./ingest.py 
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">./sample_analytics.py 
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">./advisor.py data_test/advisor_tests/gather2.ghidra
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">...
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">The best match is id=1864 [0.926]= bgeu,bltu,bne,vid.v,vl1re64.v,vrgather.vv,vrsub.vx,vs1r.v,vsetvli
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic"></span><span style="color:#a40000">
</span></span></span><span style="display:flex;"><span><span style="color:#a40000"></span><span style="color:#000;font-style:italic">The clip is similar to the reference example `data/custom_testsuite/structs/test_1_ref_rv64gcv:test_1_ref`
</span></span></span></code></pre></div><p>The extra branch instructions clutter the signature match result somewhat.</p>
<h2 id="feature-extraction">Feature extraction</h2>
<p>What generalized features does this example provide?</p>
<ol>
<li>There is a single loop</li>
<li>The loop includes one vector load, one vector store, and one vector gather
operation.</li>
<li>The loop exit condition depends on a scalar counter advancing to equal or
exceed a fixed limit value, without a dependency on vector element values.</li>
<li>Source and destination pointers increment with different values</li>
<li>The loop setup identifies the SEW as 64 bits.  This is unchanged throughout
the sample code.  This implies that this <code>vs1r.v</code> instruction is equivalent to
a <code>vse64.v</code> instruction.</li>
<li>The <code>bgeu</code> instruction terminating the loop could be encoded as <code>bleu</code> with
reversed operands.  More generally, the loop termination could have been
implemented in several different ways.</li>
</ol>
<p>Register assignments appear to be:</p>
<table>
  <thead>
      <tr>
          <th>Assignment</th>
          <th>Register</th>
          <th>Initializations</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>Source address</td>
          <td>a4</td>
          <td></td>
      </tr>
      <tr>
          <td>Source address increment</td>
          <td>t4</td>
          <td>= (-vlenb)</td>
      </tr>
      <tr>
          <td>Destination address</td>
          <td>a3</td>
          <td></td>
      </tr>
      <tr>
          <td>Destination address increment</td>
          <td>t3</td>
          <td>= vlenb</td>
      </tr>
      <tr>
          <td>Loop counter</td>
          <td>a5</td>
          <td>=0</td>
      </tr>
      <tr>
          <td>Loop counter increment</td>
          <td>a7</td>
          <td>vlenb&raquo;3</td>
      </tr>
      <tr>
          <td>Loop counter limit</td>
          <td>t5</td>
          <td></td>
      </tr>
      <tr>
          <td>Source vector register</td>
          <td>v2</td>
          <td></td>
      </tr>
      <tr>
          <td>Destination vector register</td>
          <td>v1</td>
          <td></td>
      </tr>
      <tr>
          <td>Gather index vector register</td>
          <td>v3</td>
          <td>depends on vlenb</td>
      </tr>
  </tbody>
</table>
<p>The vector gather index register v3 depends on vl, the number
of 64 bit elements that fit within a vector register.</p>
<ul>
<li>if vlen = 128 - or vlenb = 16 - then v3 = (1,0)</li>
<li>if vlen = 256 - or vlenb = 32 - then v3 = (3,2,1,0)</li>
</ul>
<p>It is not at all clear whether the compiler knows the size of the
source vector, or whether the code works as intended when
the source vector size is odd or smaller than the size of a vector
register.</p>
<p>We can resolve that by looking at Ghidra&rsquo;s decompiler window.
The vector instruction stanza actually begins earlier, executing the vector instructions
only after a test of vlenb.</p>
<h3 id="examination-of-test_1_ref">Examination of test_1_ref</h3>
<p>GCC 15 compiles <code>test_1_ref.c</code> into something more complex than the assembly code stanza
we analyzed.  The single-line loop becomes three loops - a scalar loop to handle
relatively small vector sizes, then a vector loop to handle an integer number of VLEN strips, finally a second
scalar loop to handle any remaining elements.  For the code stanza passed in for analysis the
input and output vectors appear to have a fixed size known to the compiler - 64 bytes.  This implies
no scalar loops needed for VLEN=128 bits or VLEN=256 bits.  The code stanza would generate
a buffer overflow error for VLEN&gt;512 bits.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">void</span> <span style="color:#000">test_1_ref</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">ulonglong</span> <span style="color:#ce5c00;font-weight:bold">*</span><span style="color:#000">in</span><span style="color:#000;font-weight:bold">,</span><span style="color:#000">ulonglong</span> <span style="color:#ce5c00;font-weight:bold">*</span><span style="color:#000">out</span><span style="color:#000;font-weight:bold">,</span><span style="color:#000">ulong</span> <span style="color:#000">size</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000">ulonglong</span> <span style="color:#ce5c00;font-weight:bold">*</span><span style="color:#000">pIn</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000">ulonglong</span> <span style="color:#ce5c00;font-weight:bold">*</span><span style="color:#000">puVar1</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#204a87;font-weight:bold">long</span> <span style="color:#000">lVar2</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000">ulonglong</span> <span style="color:#000">uVar3</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000">ulong</span> <span style="color:#000">uVar4</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000">ulong</span> <span style="color:#000">uVar5</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#204a87;font-weight:bold">int</span> <span style="color:#000">iVar6</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000">undefined</span> <span style="color:#000">auVar7</span> <span style="color:#000;font-weight:bold">[</span><span style="color:#0000cf;font-weight:bold">256</span><span style="color:#000;font-weight:bold">];</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000">undefined</span> <span style="color:#000">auVar8</span> <span style="color:#000;font-weight:bold">[</span><span style="color:#0000cf;font-weight:bold">256</span><span style="color:#000;font-weight:bold">];</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000">ulong</span> <span style="color:#000">in_vlenb</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000">ulonglong</span> <span style="color:#ce5c00;font-weight:bold">*</span><span style="color:#000">pOut</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>  <span style="color:#000">gp</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#ce5c00;font-weight:bold">&amp;</span><span style="color:#000">__global_pointer</span><span style="color:#a40000">$</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#000">size</span> <span style="color:#ce5c00;font-weight:bold">!=</span> <span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">uVar5</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#000">ulong</span><span style="color:#000;font-weight:bold">)((</span><span style="color:#204a87;font-weight:bold">int</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000">size</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#ce5c00;font-weight:bold">-</span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">(((</span><span style="color:#000">uVar5</span> <span style="color:#ce5c00;font-weight:bold">&lt;</span> <span style="color:#0000cf;font-weight:bold">0xd</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">||</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#000">uVar5</span> <span style="color:#ce5c00;font-weight:bold">&lt;</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#000">ulong</span><span style="color:#000;font-weight:bold">)(</span><span style="color:#204a87;font-weight:bold">long</span><span style="color:#000;font-weight:bold">)((</span><span style="color:#204a87;font-weight:bold">int</span><span style="color:#000;font-weight:bold">)(</span><span style="color:#000">in_vlenb</span> <span style="color:#ce5c00;font-weight:bold">&gt;&gt;</span> <span style="color:#0000cf;font-weight:bold">3</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#ce5c00;font-weight:bold">-</span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">)))</span> <span style="color:#ce5c00;font-weight:bold">||</span>
</span></span><span style="display:flex;"><span>       <span style="color:#000;font-weight:bold">((</span><span style="color:#000">lVar2</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">uVar5</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">in</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#000">lVar2</span> <span style="color:#ce5c00;font-weight:bold">-</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#000">size</span> <span style="color:#ce5c00;font-weight:bold">&amp;</span> <span style="color:#0000cf;font-weight:bold">0xffffffff</span><span style="color:#000;font-weight:bold">))</span> <span style="color:#ce5c00;font-weight:bold">&lt;</span> <span style="color:#000">out</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#000">size</span> <span style="color:#ce5c00;font-weight:bold">&amp;</span> <span style="color:#0000cf;font-weight:bold">0xffffffff</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">&amp;&amp;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">(</span><span style="color:#000">out</span> <span style="color:#ce5c00;font-weight:bold">&lt;</span> <span style="color:#000">in</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#000">lVar2</span><span style="color:#000;font-weight:bold">))))</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>      <span style="color:#000">pIn</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">in</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#000">uVar5</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#000">pOut</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">out</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#204a87;font-weight:bold">do</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">uVar3</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#ce5c00;font-weight:bold">*</span><span style="color:#000">pIn</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">puVar1</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">pOut</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">pIn</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">pIn</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#ce5c00;font-weight:bold">-</span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">*</span><span style="color:#000">pOut</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">uVar3</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">pOut</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">puVar1</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#000;font-weight:bold">}</span> <span style="color:#204a87;font-weight:bold">while</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#000">puVar1</span> <span style="color:#ce5c00;font-weight:bold">!=</span> <span style="color:#000">out</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#000">size</span> <span style="color:#ce5c00;font-weight:bold">&amp;</span> <span style="color:#0000cf;font-weight:bold">0xffffffff</span><span style="color:#000;font-weight:bold">));</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">else</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>      <span style="color:#000">vsetvli_e64m1tama</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>      <span style="color:#000">auVar8</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">vid_v</span><span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>      <span style="color:#000">auVar8</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">vrsub_vx</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">auVar8</span><span style="color:#000;font-weight:bold">,(</span><span style="color:#000">in_vlenb</span> <span style="color:#ce5c00;font-weight:bold">&gt;&gt;</span> <span style="color:#0000cf;font-weight:bold">3</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">-</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>      <span style="color:#000">lVar2</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">lVar2</span> <span style="color:#ce5c00;font-weight:bold">*</span> <span style="color:#0000cf;font-weight:bold">8</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#ce5c00;font-weight:bold">-</span><span style="color:#000">in_vlenb</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">long</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000">in</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#000">iVar6</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">int</span><span style="color:#000;font-weight:bold">)(</span><span style="color:#000">in_vlenb</span> <span style="color:#ce5c00;font-weight:bold">&gt;&gt;</span> <span style="color:#0000cf;font-weight:bold">3</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>      <span style="color:#000">uVar4</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#000">pOut</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">out</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#204a87;font-weight:bold">do</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">auVar7</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">vl1re64_v</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">lVar2</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">uVar4</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#000">ulong</span><span style="color:#000;font-weight:bold">)((</span><span style="color:#204a87;font-weight:bold">int</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000">uVar4</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#000">iVar6</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">lVar2</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">lVar2</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#ce5c00;font-weight:bold">-</span><span style="color:#000">in_vlenb</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">auVar7</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">vrgather_vv</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">auVar7</span><span style="color:#000;font-weight:bold">,</span><span style="color:#000">auVar8</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">vs1r_v</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">auVar7</span><span style="color:#000;font-weight:bold">,</span><span style="color:#000">pOut</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">pOut</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#000">ulonglong</span> <span style="color:#ce5c00;font-weight:bold">*</span><span style="color:#000;font-weight:bold">)((</span><span style="color:#204a87;font-weight:bold">long</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000">pOut</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#000">in_vlenb</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>      <span style="color:#000;font-weight:bold">}</span> <span style="color:#204a87;font-weight:bold">while</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#000">uVar4</span> <span style="color:#ce5c00;font-weight:bold">&lt;=</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#000">ulong</span><span style="color:#000;font-weight:bold">)(</span><span style="color:#204a87;font-weight:bold">long</span><span style="color:#000;font-weight:bold">)((</span><span style="color:#204a87;font-weight:bold">int</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000">size</span> <span style="color:#ce5c00;font-weight:bold">-</span> <span style="color:#000">iVar6</span><span style="color:#000;font-weight:bold">));</span>
</span></span><span style="display:flex;"><span>      <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#000">size</span> <span style="color:#ce5c00;font-weight:bold">!=</span> <span style="color:#000">uVar4</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">pOut</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">in</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#000">uVar5</span> <span style="color:#ce5c00;font-weight:bold">-</span> <span style="color:#000">uVar4</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">pIn</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">out</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#000">uVar4</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">do</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>          <span style="color:#000">uVar3</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#ce5c00;font-weight:bold">*</span><span style="color:#000">pOut</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>          <span style="color:#000">uVar4</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#000">ulong</span><span style="color:#000;font-weight:bold">)((</span><span style="color:#204a87;font-weight:bold">int</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000">uVar4</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>          <span style="color:#000">pOut</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">pOut</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#ce5c00;font-weight:bold">-</span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>          <span style="color:#ce5c00;font-weight:bold">*</span><span style="color:#000">pIn</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">uVar3</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>          <span style="color:#000">pIn</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">pIn</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">}</span> <span style="color:#204a87;font-weight:bold">while</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#000">uVar4</span> <span style="color:#ce5c00;font-weight:bold">&lt;</span> <span style="color:#000">size</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">return</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>  <span style="color:#204a87;font-weight:bold">return</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div><p>The scalar loop consists of about 22 bytes, or 7 instructions.  The full vector function takes up 180 bytes.
There is little reason to believe that vectorization actually improves this code, especially for vector
harts holding only two 64 bit objects per vector register.</p>
<h3 id="summary">Summary</h3>
<p>There is no visible reason to enable full autovectorization for datapath network routing code like DPDK.
It <em>might</em> make sense to vectorize lockable critical regions or specific critical path code.
Vector replacement of utility functions like memcpy or strncmp would still make sense.
If someone created an AI-adaptive network appliance the math inference engine portions would likely be improved
with vectorization.</p>

</div>



    
	
  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-4ec550678510a1633618c95f28de2784">2 - Ghidra Advisor Reference</h1>
    
	
</div>



    
      
  
  
  
  

  
  

  
    
    
	
    

<div class="td-content" style="">
    
	<h1 id="pg-868196f5affa8721be3812a5a8efb1d8">2.1 - Advisor Dependencies</h1>
    
	<h2 id="ghidra">Ghidra</h2>
<ul>
<li>Ghidra 11.3_DEV with the RISCV-64 <a href="https://github.com/thixotropist/ghidra/tree/isa_ext">isa_ext</a> branch.
Without this branch Ghidra is stuck with a never-ratified older version of RISCV support.</li>
</ul>
<h2 id="bazel">Bazel</h2>
<ul>
<li><a href="https://github.com/bazelbuild/bazel/releases">Bazel 11.4</a></li>
</ul>
<p>Bazel builds in this workspace generate output in the temporary directory /run/user/1000/bazel, as specified in .bazelrc.
This override can be changed or removed.</p>
<h2 id="toolchain">Toolchain</h2>
<ul>
<li><a href="https://sourceware.org/git/binutils-gdb">binutils 2.42.50</a></li>
<li><a href="https://gcc.gnu.org/git/gcc">gcc 15.0</a></li>
<li>glibc developmental version 2.39.9000</li>
<li>sysroot - a stripped down linux sysroot derived from the sysroot bootstrap in
<a href="https://github.com/riscv-collab/riscv-gnu-toolchain">riscv-gnu-toolchain</a></li>
</ul>
<p>The toolchain is packaged locally as a Bazel module named <code>gcc_riscv_suite</code>, version 15.0.0.
This module depends on a second module, <code>fedora_syslibs</code> version 40.0.0.  These are served out of a local
Bazel module repository.
The <code>gcc_riscv_suite</code> and <code>fedora_syslibs</code> modules wrap a 42 MB and 4.0 MB tarball, respectively.</p>
<h2 id="emulators">Emulators</h2>
<p>Two qemu emulators are used, both built from source shortly after the 9.0.50 release.</p>
<ul>
<li><code>qemu-riscv64</code> provides user space emulation, which is very useful for exploring the behavior of
particularly confusing assembly code sequences.</li>
<li><code>qemu-system-riscv64</code> provides full RISCV-64 VM hosting.  This is more narrowly useful when testing
binaries that require non-standard kernel options or kernel modules.
<ul>
<li>The RISCV-64 VM used here is based on an Ubuntu 24.04 disk image and the <code>u-boot.bin</code> boot loader.
This boot loader is critical for RISCV VMs, since the emulated BIOS firmware provides the kernel
with the definitive set of RISCV extensions available to the hardware threads (aka harts)</li>
</ul>
</li>
</ul>
<h2 id="jupyter">Jupyter</h2>
<ul>
<li>jupyterlab 4.1.1</li>
</ul>
<h2 id="system">System</h2>
<ul>
<li>Fedora 40 with wayland graphics.</li>
<li>Python 3</li>
</ul>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-f21f4498c9757bdf77b86a4592fd69d4">2.2 - Populating the Database</h1>
    
	<p>The training set consists of matched C source code and RISCV-64 disassembly code.
The C source is processed through the C preprocessor <code>cpp</code> and <code>indent</code>.  That code is then
compiled with GCC and at least two different machine architectures, then saved under <code>./data</code>.</p>
<h2 id="populating-the-training-set-database">Populating the Training Set Database</h2>
<p>The initial C source code is selected from the GCC riscv autovector testsuite.  We can add
custom examples of code to fill gaps or represent code patterns we might find in a Ghidra binary
under review.  Autovectored loops over structure arrays can be especially confusing to interpret,
so we will likely want extra samples of that type.</p>
<p>The C sources for these two test suites appear in <code>./gcc_riscv_testsuite</code> and <code>./custom_testsuite</code>.
The script <code>generator.py</code> processes these into cpp output (<code>*.i</code>), compiled libraries (<code>*.so</code>), and objdump
assembly listings (<code>*_objdump</code>) for each requested machine architecture.</p>
<p>For example, <code>gcc_riscv_testsuite/rvv/autovec/reduc/reduc-1.c</code> is processed by <code>generator.py</code> into:</p>
<ul>
<li><code>data/gcc_riscv_testsuite/rvv/autovec/reduc/reduc-1_rv64gc.i</code></li>
<li><code>data/gcc_riscv_testsuite/rvv/autovec/reduc/reduc-1_rv64gc.so</code></li>
<li><code>data/gcc_riscv_testsuite/rvv/autovec/reduc/reduc-1_rv64gc_objdump</code></li>
<li><code>data/gcc_riscv_testsuite/rvv/autovec/reduc/reduc-1_rv64gcv.i</code></li>
<li><code>data/gcc_riscv_testsuite/rvv/autovec/reduc/reduc-1_rv64gcv.so</code></li>
<li><code>data/gcc_riscv_testsuite/rvv/autovec/reduc/reduc-1_rv64gcv_objdump</code></li>
</ul>
<p>The <code>ingest.py</code> script reads everything under <code>./data</code> to populate the <code>sample</code> table in the Sqlite3 database</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">.</span><span style="color:#204a87;font-weight:bold">schema</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">sample</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">CREATE</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">TABLE</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">sample</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">id</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87">INTEGER</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">PRIMARY</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">KEY</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">AUTOINCREMENT</span><span style="color:#000;font-weight:bold">,</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">namespace</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87">TEXT</span><span style="color:#000;font-weight:bold">,</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">arch</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87">TEXT</span><span style="color:#000;font-weight:bold">,</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">name</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87">TEXT</span><span style="color:#000;font-weight:bold">,</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">source</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87">TEXT</span><span style="color:#000;font-weight:bold">,</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">assembly</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87">TEXT</span><span style="color:#000;font-weight:bold">);</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><p>Next we need to generate signatures from this table with the <code>sample_analytics.py</code> script.  At present, signatures are simple
strings.  We have three signature types at the moment.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">.</span><span style="color:#204a87;font-weight:bold">schema</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">signatures</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">CREATE</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">TABLE</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">signatures</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">id</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87">INTEGER</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">PRIMARY</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">KEY</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">AUTOINCREMENT</span><span style="color:#000;font-weight:bold">,</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">sample_id</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87">INTEGER</span><span style="color:#000;font-weight:bold">,</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">signature_type</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87">TEXT</span><span style="color:#000;font-weight:bold">,</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">signature_value</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87">TEXT</span><span style="color:#000;font-weight:bold">);</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">select</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">distinct</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">signature_type</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">from</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">signatures</span><span style="color:#000;font-weight:bold">;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#000">Traits</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#000">Opcodes</span><span style="color:#000;font-weight:bold">,</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">sorted</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#000">Opcodes</span><span style="color:#000;font-weight:bold">,</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">ordered</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><ul>
<li>The <code>Traits</code> signature holds simple facts from the disassembly code, such as <code>hasLoop</code> if at least one backwards branch exists.</li>
<li>The <code>Opcodes, ordered</code> signature is a simple list of vector and branch opcodes, concatenated in the same order as
they are found in the disassembly.</li>
<li>The <code>Opcodes, sorted</code> signature is similar to <code>Opcodes, ordered</code>, but sorted into alphanumeric order.  This may be useful if
the compiler reorders instructions.</li>
</ul>
<h2 id="querying-the-database-in-advisor">Querying the Database in Advisor</h2>

<figure>
    <img src="Workflow_advisor.svg" width="80%"/> 
</figure>

<p>Users can select assembly code from Ghidra&rsquo;s listing window, then run analysis cells in <code>Advisor.ipynb</code> to generate reports
on the types of C code that may match the listing.  Users will likely want to iterate complex selections by adding custom
examples and repeating the match, to see if they can reproduce the C code that might have generated the vectorized assembly.</p>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-1dc8dc49d608914ca839f8eefdd93a8e">2.3 - Feature Analysis</h1>
    
	<p>At a very high level the Advisor tries to translate between two languages - C or C++ source code that a human might write
and the sequence of assembly language instructions a compiler generates.  Compilers are very good at the forward translation
from C to assembly.  We want something that works in the reverse direction - suggesting C or other source code
that might have been compiled into specific assembly sequences.</p>
<p>The Advisor tries to brute-force this reverse translation by compiling a reference set of C sources into binaries, extracting
the instructions with <code>objdump</code> into a database, then looking for the best match to the instructions copied into the clipboard.
The GCC compiler test suite gives us thousands of reference C functions to start with.</p>
<p>Some features are easy to recognize.</p>
<ul>
<li>if the assembly listing includes a backwards branch instruction and branch target, then the source code likely
contains a vectorized loop.</li>
<li>if the assembly listing includes an instruction matching <code>vred*</code>, <code>vfred*</code> <code>vwred*</code>, then the source code likely
contains a vectorized reduction loop reading a vector and emitting a scalar.</li>
</ul>
<p>Other features are mostly distractions, adding entropy that we would like to ignore:</p>
<ul>
<li>The local choice of registers to hold intermediate values</li>
<li>The specific loop termination branch condition - a test against a counter, an input pointer,
or an output pointer are all equally valid but only one will be implemented.</li>
<li>Instruction ordering is often arbitrary inside a loop, as counters and pointers are incremented/decremented.</li>
<li>The compiler may reorder instructions to minimize the impact of memory latency.</li>
<li>The compiler will change the emitted instructions for inlined function depending on what it knows at compile
time.  This is especially true when the compiler knows the exact number of loop iterations, the alignment of
operands, and the minimum size of vector registers.</li>
<li>The compiler will change the emitted instructions based on the local &lsquo;register pressure&rsquo; - whether or not there are lots
of free vector registers.</li>
<li>The compiler (or inline header macros) will translate a simple loop into multiple code blocks evaluated at run time.
If the count is small, a scalar implementation is used.  If the count is large one or more vector blocks are used.</li>
<li>The compiler writers sometimes have to guess whether to optimize for instruction count, minimal branches, or memory
accesses.</li>
</ul>
<p>And some features are harder to recognize but useful for the Ghidra user:</p>
<ul>
<li>Operand type is sometimes set at runtime, not encoded into the instruction opcode.</li>
<li>Compilers can emit completely different code if the machine architecture indicates a vector length of greater than 128 bits.</li>
<li>Vector registers may be grouped based on runtime context, so that the number of registers read or written must be inferred
from instruction flows.</li>
<li>The compiler will accept intrinsic vector functions - not all vector loops have a C counterpart.</li>
</ul>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-7708ebcad404a8a36f7be4d1b0591b8c">2.4 - Frequently Asked Questions</h1>
    
	<dl>
<dt>Why Bazel?</dt>
<dd>Bazel does a good job of managing cross-compiler builds and build caches together,
where the cross-compiler toolchain can be switched easily.</dd>
<dt>How do I compile with support for RISCV Instruction Set Architecture extensions?</dt>
<dd>The binutils and gcc base code need to support those extensions first.
The gcc compiler uses the <code>-march=</code> command line option to identify which
extensions to apply for a given compilation. For example <code>-march=rv32gcv</code> says
vector instructions are supported, while <code>-march=rv32gc</code> excludes vector instructions.</dd>
<dt>What machine architectures are currently implemented?</dt>
<dd>The <code>variables.bzl</code> file sets <code>MARCH_SET = (&quot;rv64gc&quot;, &quot;rv64gcv&quot;)</code>.  Most sources are then
compiled with and without vector support.</dd>
<dt>Are all RISCV vector binaries runnable on all vector hardware threads?</dt>
<dd>Not always.  By default GCC will build for a minimum vector register length (<code>VLEN</code>) of 128 bits,
which should be portable across all general purpose RISCV harts.  If <code>_zvl512b</code> were
added to the <code>-march</code> setting, GCC will know that vector registers are bigger and can unroll
loops more aggressively - generating code that will fail on 128 bit vector harts.  This can
get complicated when processors have both 128 bit and 512 bit cores, like the sg2380.</dd>
<dt>Aren&rsquo;t vector extensions unlikely to be used in programs that don&rsquo;t do vector math?</dt>
<dd>No.  Vector extensions are very likely to be found in inlined utilities like memcpy and strncmp.
Most simple loops over arrays of structs can be optimized with vector instructions.</dd>
</dl>

</div>



    
	
  

    
	
  



          </main>
        </div>
      </div>
      <footer class="td-footer row d-print-none">
  <div class="container-fluid">
    <div class="row mx-md-2">
      <div class="td-footer__left col-6 col-sm-4 order-sm-1">
        
      </div><div class="td-footer__right col-6 col-sm-4 order-sm-3">
        <ul class="td-footer__links-list">
  
  <li class="td-footer__links-item" data-bs-toggle="tooltip" title="GitHub" aria-label="GitHub">
    <a target="_blank" rel="noopener" href="https://github.com/google/docsy" aria-label="GitHub">
      <i class="fab fa-github"></i>
    </a>
  </li>
  
</ul>

      </div><div class="td-footer__center col-12 col-sm-4 py-2 order-sm-2">
        <span class="td-footer__copyright">&copy;
    2024&ndash;2024
    <span class="td-footer__authors">Thixotropist | <a href="https://creativecommons.org/licenses/by/4.0">CC BY 4.0</a> |</span></span><span class="td-footer__all_rights_reserved">All Rights Reserved</span><span class="ms-2"><a href="https://policies.google.com/privacy" target="_blank" rel="noopener">Privacy Policy</a></span>
      </div>
    </div>
  </div>
</footer>

    </div>
    <script src="ghidra_advisor/js/main.min.8a05dcc39d91f21cdf8bc6e9b3a58055477119d3c6b18aff8bfec7cfd4640e99.js" integrity="sha256-igXcw52R8hzfi8bps6WAVUdxGdPGsYr/i/7Hz9RkDpk=" crossorigin="anonymous"></script>
<script defer src="ghidra_advisor/js/click-to-copy.min.73478a7d4807698aed7e355eb23f9890ca18fea3158604c8471746d046702bad.js" integrity="sha256-c0eKfUgHaYrtfjVesj&#43;YkMoY/qMVhgTIRxdG0EZwK60=" crossorigin="anonymous"></script>
<script src='/ghidra_advisor/js/tabpane-persist.js'></script>

  </body>
</html>
